# üçΩÔ∏è –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π —à–∞–±–ª–æ–Ω–æ–≤ –ø–∏—Ç–∞–Ω–∏—è

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å, –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–±–ª–æ–Ω–æ–≤ –ø–∏—Ç–∞–Ω–∏—è –∏–∑ JSON —Ñ–∞–π–ª–æ–≤.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
data/
  templates/           # JSON —Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–æ–≤
    *.json
server/
  tasks/
    migrations/        # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
      run-template-migrations.ts
      create-migration.ts
    templates/         # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏
      generate-template.ts
      validate-templates.ts
    db/               # –û—Ç–¥–µ–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (legacy)
      *.ts
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π

```bash
pnpm migrate
```

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –∏–∑ –ø–∞–ø–∫–∏ `data/templates/*.json`

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤

```bash
pnpm migrate:validate
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö JSON —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

```bash
pnpm migrate:generate
```

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

## üìã –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏

**–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**

```bash
pnpm migrate
# –∏–ª–∏
nitro task run db:migrate-templates --payload "{}"
```

**–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω:**

```bash
nitro task run db:import-template --payload '{"filename": "woman-50-60kg.json"}'
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —à–∞–±–ª–æ–Ω—ã:**

```bash
pnpm migrate:validate
# –∏–ª–∏
nitro task run templates:validate --payload "{}"
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤

**–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω:**

```bash
nitro task run templates:generate --payload '{
  "name": "–ú—É–∂—á–∏–Ω–∞ 70-80 –∫–≥",
  "description": "–®–∞–±–ª–æ–Ω –¥–ª—è –º—É–∂—á–∏–Ω 70-80 –∫–≥",
  "mealsCount": 5,
  "categoriesPerMeal": ["–∞", "–±", "–≤", "–≥", "–¥"],
  "withExampleIngredients": true
}'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**

- `name` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `description` - –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `mealsCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- `categoriesPerMeal` - –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ["–∞", "–±", "–≤", "–≥", "–¥"])
- `withExampleIngredients` - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

**–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —à–∞–±–ª–æ–Ω–∞:**

```bash
nitro task run migrations:create --payload '{
  "templateName": "–°–ø–æ—Ä—Ç—Å–º–µ–Ω 80-90 –∫–≥",
  "migrationName": "athlete-80-90kg",
  "description": "–ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤ 80-90 –∫–≥"
}'
```

## üìÑ –§–æ—Ä–º–∞—Ç JSON —à–∞–±–ª–æ–Ω–∞

```json
{
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "meals": [
    {
      "name": "1Ô∏è‚É£ –ø—Ä–∏–π–æ–º —ó–∂—ñ",
      "categories": [
        {
          "name": "–∞",
          "description": "–í—É–≥–ª–µ–≤–æ–¥–∏",
          "targetCalories": 110,
          "ingredients": [
            {
              "name": "–ë–æ–±–æ–≤—ñ",
              "calories": 110,
              "proteins": 8,
              "grams": 30
            }
          ]
        }
      ]
    }
  ]
}
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `meals` - –º–∞—Å—Å–∏–≤ –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏
- `meals[].name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
- `meals[].categories` - –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `meals[].categories[].name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `meals[].categories[].ingredients` - –º–∞—Å—Å–∏–≤ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- `ingredients[].name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
- `ingredients[].calories` - –∫–∞–ª–æ—Ä–∏–∏
- `ingredients[].proteins` - –±–µ–ª–∫–∏
- `ingredients[].grams` - –≥—Ä–∞–º–º—ã

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:

- `description` - –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `meals[].categories[].description` - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `meals[].categories[].targetCalories` - —Ü–µ–ª–µ–≤—ã–µ –∫–∞–ª–æ—Ä–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –±—É–∫–≤–∞–º

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ —É–∫—Ä–∞–∏–Ω—Å–∫–∏–º –±—É–∫–≤–∞–º:

- **–∞** - –í—É–≥–ª–µ–≤–æ–¥–∏ (110 –∫–∫–∞–ª)
- **–±** - –ú–æ–ª–æ—á–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ (65 –∫–∫–∞–ª)
- **–≤** - –í—ñ–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä (450 –∫–∫–∞–ª)
- **–≥** - –ú'—è—Å–æ —Ç–∞ —Ä–∏–±–∞ (120 –∫–∫–∞–ª)
- **–¥** - –û–≤–æ—á—ñ (25 –∫–∫–∞–ª)
- **–µ** - –§—Ä—É–∫—Ç–∏ (60 –∫–∫–∞–ª)
- **—î** - –ñ–∏—Ä–∏ (45 –∫–∫–∞–ª)
- **–∂** - –ì–æ—Ä—ñ—Ö–∏ —Ç–∞ –Ω–∞—Å—ñ–Ω–Ω—è (165 –∫–∫–∞–ª)
- **–∑** - –ó–ª–∞–∫–∏ (110 –∫–∫–∞–ª)
- **–∏** - –Ø–π—Ü—è (75 –∫–∫–∞–ª)
- **—ñ** - –ë–æ–±–æ–≤—ñ (110 –∫–∫–∞–ª)
- **—ó** - –ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏ (120 –∫–∫–∞–ª)
- **–π** - –î–æ–¥–∞—Ç–∫–∏ (20 –∫–∫–∞–ª)

## üîÑ Workflow –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

1. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω:**

   ```bash
   nitro task run templates:generate --payload '{"name": "–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω"}'
   ```

2. **–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º JSON —Ñ–∞–π–ª:**
   –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ `data/templates/–Ω–æ–≤—ã–π-—à–∞–±–ª–æ–Ω.json` –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ

3. **–í–∞–ª–∏–¥–∏—Ä—É–µ–º:**

   ```bash
   pnpm migrate:validate
   ```

4. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º:**
   ```bash
   pnpm migrate
   ```

## üõ†Ô∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞:

1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

   ```bash
   nitro task run migrations:create --payload '{"templateName": "–ú–æ–π —à–∞–±–ª–æ–Ω"}'
   ```

2. –°–æ–∑–¥–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π JSON —Ñ–∞–π–ª –≤ `data/templates/`

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:
   ```bash
   nitro task run db:migrate-–º–æ–π-—à–∞–±–ª–æ–Ω --payload "{}"
   ```

### –ö–∞—Å—Ç–æ–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å JSON —Ñ–æ—Ä–º–∞—Ç–∞
- –ù–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–ª–æ—Ä–∏–π, –±–µ–ª–∫–æ–≤ –∏ –≥—Ä–∞–º–º–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–µ–π

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∏–º–µ–Ω–∞–º–∏, –≤—ã–≤–æ–¥—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–≤–æ–¥—è—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤, –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –¥—É–±–ª–µ–π
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π —à–∞–±–ª–æ–Ω –¥–ª—è –∂–µ–Ω—â–∏–Ω

```bash
nitro task run templates:generate --payload '{
  "name": "–ñ–µ–Ω—â–∏–Ω–∞ 55-65 –∫–≥",
  "mealsCount": 4,
  "categoriesPerMeal": ["–∞", "–±", "–≤"]
}'
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤

```bash
nitro task run templates:generate --payload '{
  "name": "–°–ø–æ—Ä—Ç—Å–º–µ–Ω —Ç—è–∂–µ–ª–æ–≤–µ—Å",
  "description": "–î–ª—è —Ç—è–∂–µ–ª—ã—Ö –∞—Ç–ª–µ—Ç–æ–≤ –∏ –ø–∞—É—ç—Ä–ª–∏—Ñ—Ç–µ—Ä–æ–≤",
  "mealsCount": 6,
  "categoriesPerMeal": ["–∞", "–±", "–≤", "–≥", "–¥", "–µ", "—î", "–∂"]
}'
```

### –ò–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

```bash
nitro task run db:import-template --payload '{"filename": "athlete-heavy.json"}'
```

---

üí° **–°–æ–≤–µ—Ç:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pnpm migrate:validate` –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö!
